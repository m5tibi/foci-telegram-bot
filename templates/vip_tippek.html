{% extends "base.html" %}

{% block title %}VIP Tippek - Mondom a Tutit!{% endblock %}

{% block content %}
    <h1>VIP Zóna</h1>

    {% if is_subscribed %}

        {% if active_manual_slips %}
            <div class="manual-slips-section">
                <h3>Szerkesztői Szelvények</h3>
                
                <div class="manual-slips-grid">
                {% for slip in active_manual_slips %}
                    {% if slip.image_url %}
                        <a href="{{ slip.image_url }}" target="_blank" class="manual-slip-card">
                            <img src="{{ slip.image_url }}" alt="{{ slip.tipp_neve }}">
                            <div class="manual-card-footer" style="text-align: center;">
                                <span class="manual-card-title">{{ slip.tipp_neve }}</span>
                                <span class="manual-card-date">Lejárat: {{ slip.target_date }}</span>
                            </div>
                        </a>
                    {% endif %}
                {% endfor %}
                </div>
            </div>
        {% endif %}
        {% if todays_slips or tomorrows_slips %}
            <h3>Bot Által Javasolt Napi Tippek</h3>
            
            {% if todays_slips %}
                <h4>Mai Napi Tuti Szelvény(ek)</h4>
                <div class="slips-container">
                    {% for slip in todays_slips %}
                        <div class="slip-card {% if slip.is_admin_only %}admin-only{% endif %}">
                            <div class="slip-header">
                                <span class="slip-title">{{ slip.tipp_neve }}</span>
                                <span class="slip-odds">@ {{ "%.2f"|format(slip.eredo_odds) }}</span>
                                {% if slip.is_admin_only %}
                                    <span class="admin-badge">CSAK ADMIN</span>
                                {% endif %}
                            </div>
                            <div class="slip-meta">
                                Megbízhatóság: {{ slip.confidence_percent | default('N/A') }}%
                            </div>
                            <div class="slip-matches">
                                {% for meccs in slip.meccsek %}
                                <div class="match">
                                    <div class="match-teams">{{ meccs.csapat_H }} vs {{ meccs.csapat_V }}</div>
                                    <div class="match-league">{{ meccs.liga_nev }} | {{ meccs.kezdes_str }}</div>
                                    <div class="match-tip">
                                        {{ meccs.tipp_str }} <span>@ {{ "%.2f"|format(meccs.odds) }}</span>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            {% if tomorrows_slips %}
                <h4 style="margin-top: 30px;">Holnapi Napi Tuti Szelvény(ek)</h4>
                <div class="slips-container">
                    {% for slip in tomorrows_slips %}
                        <div class="slip-card {% if slip.is_admin_only %}admin-only{% endif %}">
                            <div class="slip-header">
                                <span class="slip-title">{{ slip.tipp_neve }}</span>
                                <span class="slip-odds">@ {{ "%.2f"|format(slip.eredo_odds) }}</span>
                                {% if slip.is_admin_only %}
                                    <span class="admin-badge">CSAK ADMIN</span>
                                {% endif %}
                            </div>
                            <div class="slip-meta">
                                Megbízhatóság: {{ slip.confidence_percent | default('N/A') }}%
                            </div>
                            <div class="slip-matches">
                                {% for meccs in slip.meccsek %}
                                <div class="match">
                                    <div class="match-teams">{{ meccs.csapat_H }} vs {{ meccs.csapat_V }}</div>
                                    <div class="match-league">{{ meccs.liga_nev }} | {{ meccs.kezdes_str }}</div>
                                    <div class="match-tip">
                                        {{ meccs.tipp_str }} <span>@ {{ "%.2f"|format(meccs.odds) }}</span>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endif %}

        {% if not todays_slips and not tomorrows_slips and not active_manual_slips %}
             <div class="alert alert-info">{{ daily_status_message | default("Jelenleg nincsenek aktív szelvények. Nézz vissza később!") }}</div>
        {% endif %}

        <div class="disclaimer">
            <p><strong>Felelősségteljes szerencsejáték:</strong> A sportfogadás magas kockázattal jár. Kérjük, csak akkora összeggel játssz, amekkora elvesztését megengedheted magadnak. A tippjeink nem garantálnak nyereséget.</p>
            <ul>
                <li>Ne próbálj meg visszanyerni veszteségeket.</li>
                <li>Csak szórakozásból játssz, ne a megélhetésért.</li>
                <li>Soha ne játssz alkoholos vagy egyéb befolyásoltság alatt.</li>
                <li>Ismerd a saját határaidat, és soha ne lépd túl őket.</li>
                <li>Csak 18 éven felülieknek. Kérj segítséget, ha úgy érzed, problémáid vannak!</li>
                <li>A tippek felhasználása kizárólag a te felelősséged, az oldal semmilyen anyagi felelősséget nem vállal.</li>
                <li>A szelvényeket gondosan válogatjuk, de a sportfogadásban nincs 100%. Mindig felelősségteljesen játssz!</li>
            </ul>
        </div>
        {% else %}
        <div class="alert alert-danger"><strong>Sajnos nincs aktív előfizetésed.</strong></div>
        <p>Kérlek, válassz egyet az alábbi csomagok közül a tippek megtekintéséhez!</p>
        <div class="pricing-grid" style="margin-top: 30px;">
            <div class="price-card">
                <h3>HETI CSOMAG</h3>
                <div class="price">3,490 Ft</div>
                <p>Ideális, ha kipróbálnád a szolgáltatást.</p>
                <form action="/create-checkout-session-web" method="POST">
                    <input type="hidden" name="plan" value="weekly">
                    <button type="submit" class="button">Előfizetek</button>
                </form>
            </div>
            <div class="price-card">
                <h3>HAVI CSOMAG</h3>
                <div class="price">9,999 Ft</div>
                <p>A legjobb ár-érték arányú választás.</p>
                <form action="/create-checkout-session-web" method="POST">
                    <input type="hidden" name="plan" value="monthly">
                    <button type="submit" class="button">Előfizetek</button>
                </form>
            </div>
        </div>
    {% endif %}

<script>
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('payment') && urlParams.get('payment') === 'success') {
        const modal = document.createElement('div');
        modal.className = 'modal-success';
        modal.innerHTML = '<h2>Sikeres Fizetés!</h2><p>Köszönjük az előfizetésed! A VIP tippek mostantól elérhetőek számodra.</p><button onclick="this.parentElement.remove()">Bezárás</button>';
        document.body.appendChild(modal);
    }
    if (urlParams.has('error') && urlParams.get('error') === 'active_subscription') {
        const modal = document.createElement('div');
        modal.className = 'modal-error';
        modal.innerHTML = '<h2>Már van előfizetésed!</h2><p>A rendszerünk szerint már rendelkezel aktív előfizetéssel. Újabb vásárlásra nincs szükség.</p><button onclick="this.parentElement.remove()">Bezárás</button>';
        document.body.appendChild(modal);
    }
</script>

{% endblock %}
