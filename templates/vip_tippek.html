{% extends "base.html" %}

{% block title %}VIP Tippek - Mondom a Tutit!{% endblock %}

{% block content %}
    <h1>VIP Z√≥na</h1>

    {% if is_subscribed %}

        {# --- Szerkeszt≈ëi Tippek Szekci√≥ (V√°ltozatlan) --- #}
        {% if manual_slips_today or manual_slips_tomorrow %}
            <div class="manual-slips-section">
                <h3>Szerkeszt≈ëi Tippek</h3>
                {% if manual_slips_today %}
                    <h4>Mai Manu√°lis Szelv√©ny(ek)</h4>
                    <div class="manual-slips-grid">
                    {% for slip in manual_slips_today %}{% if slip.image_url %}
                        <a href="{{ slip.image_url }}" target="_blank" class="manual-slip-card">
                            <img src="{{ slip.image_url }}" alt="{{ slip.tipp_neve }}">
                            <p>{{ slip.tipp_neve }}</p>
                        </a>
                    {% endif %}{% endfor %}
                    </div>
                {% endif %}
                {% if manual_slips_tomorrow %}
                    <h4 style="margin-top: 30px;">Holnapi Manu√°lis Szelv√©ny(ek)</h4>
                     <div class="manual-slips-grid">
                    {% for slip in manual_slips_tomorrow %}{% if slip.image_url %}
                        <a href="{{ slip.image_url }}" target="_blank" class="manual-slip-card">
                            <img src="{{ slip.image_url }}" alt="{{ slip.tipp_neve }}">
                            <p>{{ slip.tipp_neve }}</p>
                        </a>
                    {% endif %}{% endfor %}
                    </div>
                {% endif %}
            </div>
            <hr style="margin: 30px 0;">
        {% endif %}

        {# --- Mai Bot Tippek --- #}
        {% if todays_slips %}
            <h3>Mai Akt√≠v Szelv√©nyek (Bot √°ltal gener√°lt)</h3>
            {% for szelveny in todays_slips %}
                <div class="szelveny-card">
                    {# --- M√ìDOS√çT√ÅS ITT: Ki√≠r√°s cser√©je Becs√ºlt Es√©lyre --- #}
                    {% if szelveny.confidence_percent is not none %} {# Ebbe mentett√ºk a val√≥sz√≠n≈±s√©get %-ban #}
                        <h4>{{ szelveny.tipp_neve }} (Becs√ºlt Es√©ly: {{ szelveny.confidence_percent }}%)</h4>
                    {% else %}
                        <h4>{{ szelveny.tipp_neve }}</h4> {# Ha nincs val√≥sz√≠n≈±s√©g (pl. r√©gebbi adat) #}
                    {% endif %}
                    {# --- M√ìDOS√çT√ÅS V√âGE --- #}

                    {% for meccs in szelveny.meccsek %}
                        <div class="meccs">
                            <p>‚öΩÔ∏è <strong>{{ meccs.csapat_H }} vs {{ meccs.csapat_V }}</strong></p>
                            <p>üèÜ {{ meccs.liga_nev }}</p>
                            <p>‚è∞ Kezd√©s: {{ meccs.kezdes_str }}</p>
                            <p>üí° Tipp: {{ meccs.tipp_str }} <strong>@{{ "%.2f"|format(meccs.odds) }}</strong></p>
                        </div>
                    {% endfor %}
                    <p class="eredo-odds">
                        üéØ Ered≈ë odds: <strong>{{ "%.2f"|format(szelveny.eredo_odds) }}</strong>
                    </p>
                </div>
            {% endfor %}
        {% endif %}

        {# --- Holnapi Bot Tippek --- #}
        {% if tomorrows_slips %}
            <h3>Holnapi Szelv√©nyek (Bot √°ltal gener√°lt)</h3>
            {% for szelveny in tomorrows_slips %}
                <div class="szelveny-card tomorrow">
                     {# --- M√ìDOS√çT√ÅS ITT: Ki√≠r√°s cser√©je Becs√ºlt Es√©lyre --- #}
                     {% if szelveny.confidence_percent is not none %}
                        <h4>{{ szelveny.tipp_neve }} (Becs√ºlt Es√©ly: {{ szelveny.confidence_percent }}%)</h4>
                    {% else %}
                        <h4>{{ szelveny.tipp_neve }}</h4>
                    {% endif %}
                    {# --- M√ìDOS√çT√ÅS V√âGE --- #}

                     {% for meccs in szelveny.meccsek %}
                        <div class="meccs">
                           <p>‚öΩÔ∏è <strong>{{ meccs.csapat_H }} vs {{ meccs.csapat_V }}</strong></p>
                           <p>üèÜ {{ meccs.liga_nev }}</p>
                           <p>‚è∞ Kezd√©s: {{ meccs.kezdes_str }}</p>
                           <p>üí° Tipp: {{ meccs.tipp_str }} <strong>@{{ "%.2f"|format(meccs.odds) }}</strong></p>
                        </div>
                    {% endfor %}
                    <p class="eredo-odds">
                        üéØ Ered≈ë odds: <strong>{{ "%.2f"|format(szelveny.eredo_odds) }}</strong>
                    </p>
                </div>
            {% endfor %}
        {% endif %}

        {# --- Ha nincs tipp --- #}
        {% if not todays_slips and not tomorrows_slips and not manual_slips_today and not manual_slips_tomorrow %}
             {% if daily_status_message %}
                <div class="alert alert-success" style="text-align: center;">
                    <strong>{{ daily_status_message }}</strong>
                </div>
             {% else %}
                <p>Jelenleg nincsenek akt√≠v szelv√©nyek.</p>
             {% endif %}
        {% endif %}

        {# --- Figyelmeztet√©s (V√°ltozatlan) --- #}
        <div class="vip-notice" style="margin-top: 40px;">
            <h3>Figyelmeztet√©s √©s Felel≈ëss√©gteljes J√°t√©k</h3>
            <p>A sportfogad√°s a szerencsej√°t√©kok egy form√°ja...</p>
            <ul>...</ul>
        </div>

    {# --- Ha nincs el≈ëfizet√©s (V√°ltozatlan) --- #}
    {% else %}
        <div class="alert alert-danger"><strong>Sajnos nincs akt√≠v el≈ëfizet√©sed.</strong></div>
        <p>K√©rlek, v√°lassz egyet az al√°bbi csomagok k√∂z√ºl...</p>
        <div class="pricing-grid" style="margin-top: 30px;">...</div>
    {% endif %}

<script>
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('payment') && urlParams.get('payment') === 'success') {
        if (typeof fbq === 'function') {
            fbq('track', 'Purchase', {value: 9999, currency: 'HUF'});
        } else {
            console.log("Facebook Pixel (fbq) nem tal√°lhat√≥.");
        }
    }
</script>

{% endblock %}
