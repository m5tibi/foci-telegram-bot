{% extends "base.html" %}

{% block title %}VIP Tippek - Mondom a Tutit!{% endblock %}

{% block content %}
<style>
    /* --- EREDETI √ÅRAZ√ÅSI ST√çLUSOK --- */
    .pricing-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
        margin-top: 20px;
    }
    .pricing-card {
        background: #2D3748;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        flex: 1;
        min-width: 250px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        border: 1px solid #4A5568;
        color: white;
    }
    .pricing-card h3 { color: #fff; margin-bottom: 10px; }
    .price { font-size: 1.5rem; font-weight: bold; color: #38A169; margin-bottom: 15px; }
    .features { list-style: none; padding: 0; margin-bottom: 20px; color: #E2E8F0; font-size: 0.9em; }
    .features li { margin-bottom: 5px; }
    
    .pricing-card.popular {
        border: 2px solid #38A169;
        transform: scale(1.05);
        z-index: 1;
    }

    /* --- √öJ: RUGALMAS K√âPES ELRENDEZ√âS (FLEXBOX) --- */
    .manual-slips-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center; /* Ez h√∫zza k√∂z√©pre, ha kev√©s elem van! */
        gap: 20px;
        margin-top: 15px;
        max-width: 1000px;
        margin-left: auto;
        margin-right: auto;
    }

    .manual-slip-card {
        /* Sz√°mol√°s: (100% - 20px gap) / 2 = kb. 50% - 10px */
        /* √çgy pont 2 f√©r el egym√°s mellett g√©pen */
        flex: 0 0 calc(50% - 10px);
        
        /* De ne legyen √≥ri√°si se */
        max-width: 450px;
        
        /* St√≠lusok */
        display: block;
        background: #2D3748;
        border-radius: 10px;
        overflow: hidden;
        border: 1px solid #4A5568;
        transition: transform 0.2s;
        text-decoration: none;
        color: inherit;
        position: relative;
    }

    .manual-slip-card:hover {
        transform: translateY(-5px);
        border-color: #38A169;
        box-shadow: 0 5px 15px rgba(56, 161, 105, 0.3);
    }

    .manual-slip-card img {
        width: 100%;
        height: auto;
        display: block;
        object-fit: contain; /* Biztos√≠tja, hogy a teljes k√©p l√°tsszon */
    }

    .manual-card-footer {
        padding: 10px;
        background: rgba(0,0,0,0.4);
        border-top: 1px solid #4A5568;
    }

    .manual-card-title {
        display: block;
        font-weight: bold;
        color: #38A169;
        font-size: 1.1em;
        margin-bottom: 4px;
    }

    .manual-card-date {
        display: block;
        font-size: 0.85em;
        color: #A0AEC0;
    }
    
    /* --- MOBIL N√âZET --- */
    @media (max-width: 768px) {
        .pricing-card.popular { transform: none; }
        
        /* Mobilon mindenki 100% sz√©les (egym√°s alatt) */
        .manual-slip-card {
            flex: 0 0 100%;
            max-width: 100%;
        }
    }
</style>

    <h1>VIP Z√≥na</h1>

    {% if is_subscribed %}

        {# --- 1. SZERKESZT≈êI (VIP) TIPPEK --- #}
        {% if active_manual_slips %}
            <div class="manual-slips-section">
                <h3>Szerkeszt≈ëi Szelv√©nyek</h3>
                
                <div class="manual-slips-grid">
                {% for slip in active_manual_slips %}
                    {% if slip.image_url %}
                        <a href="{{ slip.image_url }}" target="_blank" class="manual-slip-card">
                            <img src="{{ slip.image_url }}" alt="{{ slip.tipp_neve }}">
                            <div class="manual-card-footer" style="text-align: center;">
                                <span class="manual-card-title">{{ slip.tipp_neve }}</span>
                                <span class="manual-card-date">Lej√°rat: {{ slip.target_date }}</span>
                            </div>
                        </a>
                    {% endif %}
                {% endfor %}
                </div>
            </div>
        {% endif %}

        {# --- 2. INGYENES TIPPEK --- #}
        {% if active_free_slips %}
            <div class="manual-slips-section" style="margin-top: 40px; border-top: 1px dashed #4A5568; padding-top: 20px;">
                <h3>Ingyenes Tippek</h3>
                
                <div class="manual-slips-grid">
                {% for slip in active_free_slips %}
                    {% if slip.image_url %}
                        <a href="{{ slip.image_url }}" target="_blank" class="manual-slip-card">
                            <img src="{{ slip.image_url }}" alt="{{ slip.tipp_neve }}">
                            <div class="manual-card-footer" style="text-align: center;">
                                <span class="manual-card-title">{{ slip.tipp_neve }}</span>
                                <span class="manual-card-date">Lej√°rat: {{ slip.target_date }}</span>
                            </div>
                        </a>
                    {% endif %}
                {% endfor %}
                </div>
            </div>
        {% endif %}

        {# --- 3. BOT TIPPEK --- #}
        {% if todays_slips or tomorrows_slips %}
            <h3 style="margin-top: 40px; border-top: 1px dashed #4A5568; padding-top: 20px;">Bot √Åltal Javasolt Napi Tippek</h3>
            
            {% if todays_slips %}
                <h4>Mai tippek</h4>
                <div class="slips-container">
                    {% for slip in todays_slips %}
                        <div class="slip-card {% if slip.is_admin_only %}admin-only{% endif %}">
                            <div class="slip-header">
                                <span class="slip-title">{{ slip.tipp_neve }}</span>
                                <span class="slip-odds">@ {{ "%.2f"|format(slip.eredo_odds) }}</span>
                                {% if slip.is_admin_only %}
                                    <span class="admin-badge">CSAK ADMIN</span>
                                {% endif %}
                            </div>
                            <div class="slip-meta">
                                Megb√≠zhat√≥s√°g: {{ slip.confidence_percent | default('N/A') }}%
                            </div>
                            <div class="slip-matches">
                                {% for meccs in slip.meccsek %}
                                <div class="match">
                                    <div class="match-teams">{{ meccs.csapat_H }} vs {{ meccs.csapat_V }}</div>
                                    <div class="match-league">{{ meccs.liga_nev }} | {{ meccs.kezdes_str }}</div>
                                    <div class="match-tip">
                                        {{ meccs.tipp_str }} <span>@ {{ "%.2f"|format(meccs.odds) }}</span>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            {% if tomorrows_slips %}
                <h4 style="margin-top: 30px;">Holnapi tippek</h4>
                <div class="slips-container">
                    {% for slip in tomorrows_slips %}
                        <div class="slip-card {% if slip.is_admin_only %}admin-only{% endif %}">
                            <div class="slip-header">
                                <span class="slip-title">{{ slip.tipp_neve }}</span>
                                <span class="slip-odds">@ {{ "%.2f"|format(slip.eredo_odds) }}</span>
                                {% if slip.is_admin_only %}
                                    <span class="admin-badge">CSAK ADMIN</span>
                                {% endif %}
                            </div>
                            <div class="slip-meta">
                                Megb√≠zhat√≥s√°g: {{ slip.confidence_percent | default('N/A') }}%
                            </div>
                            <div class="slip-matches">
                                {% for meccs in slip.meccsek %}
                                <div class="match">
                                    <div class="match-teams">{{ meccs.csapat_H }} vs {{ meccs.csapat_V }}</div>
                                    <div class="match-league">{{ meccs.liga_nev }} | {{ meccs.kezdes_str }}</div>
                                    <div class="match-tip">
                                        {{ meccs.tipp_str }} <span>@ {{ "%.2f"|format(meccs.odds) }}</span>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endif %}

        {% if not todays_slips and not tomorrows_slips and not active_manual_slips and not active_free_slips %}
             <div class="alert alert-info">{{ daily_status_message | default("Jelenleg nincsenek akt√≠v szelv√©nyek. N√©zz vissza k√©s≈ëbb!") }}</div>
        {% endif %}

        <div class="disclaimer">
            <p><strong>Felel≈ëss√©gteljes szerencsej√°t√©k:</strong> A sportfogad√°s magas kock√°zattal j√°r. K√©rj√ºk, csak akkora √∂sszeggel j√°tssz, amekkora elveszt√©s√©t megengedheted magadnak. A tippjeink nem garant√°lnak nyeres√©get.</p>
            <ul>
                <li>Ne pr√≥b√°lj meg visszanyerni vesztes√©geket!</li>
                <li>Csak sz√≥rakoz√°sb√≥l j√°tssz, ne a meg√©lhet√©s√©rt!</li>
                <li>Soha ne j√°tssz alkoholos vagy egy√©b befoly√°solts√°g alatt!</li>
                <li>Ismerd a saj√°t hat√°raidat, √©s soha ne l√©pd t√∫l ≈ëket!</li>
                <li>Csak 18 √©ven fel√ºlieknek. K√©rj seg√≠ts√©get, ha √∫gy √©rzed, probl√©m√°id vannak!</li>
                <li>A tippek felhaszn√°l√°sa kiz√°r√≥lag a te felel≈ëss√©ged, az oldal semmilyen anyagi felel≈ëss√©get nem v√°llal.</li>
                <li>A szelv√©nyeket gondosan v√°logatjuk, de a sportfogad√°sban nincs 100%. Mindig felel≈ëss√©gteljesen j√°tssz!</li>
            </ul>
        </div>
        
    {% else %}
        <div class="alert alert-danger"><strong>Sajnos nincs akt√≠v el≈ëfizet√©sed.</strong></div>
        <p style="text-align: center; font-size: 1.1em;">K√©rlek, v√°lassz egyet az al√°bbi csomagok k√∂z√ºl a tippek megtekint√©s√©hez!</p>
        
        <div class="pricing-container">
            <div class="pricing-card" style="border: 1px solid #F6E05E;">
                <h3 style="color: #F6E05E;">üé´ Pr√≥banap</h3>
                <p class="price" style="color: #F6E05E;">1.190 Ft<span>/nap</span></p>
                <ul class="features">
                    <li>24 √≥r√°s hozz√°f√©r√©s</li>
                    <li>Kock√°zatmentes teszt</li>
                    <li>Azonnali VIP tippek</li>
                </ul>
                <form action="/create-checkout-session-web" method="POST">
                    <input type="hidden" name="plan" value="daily">
                    <button type="submit" class="button" style="background-color: #D69E2E;">Kipr√≥b√°lom</button>
                </form>
            </div>
    
            <div class="pricing-card">
                <h3>üóìÔ∏è Heti Csomag</h3>
                <p class="price">3.490 Ft<span>/h√©t</span></p>
                <ul class="features">
                    <li>7 napos hozz√°f√©r√©s</li>
                    <li>Minden VIP tipp</li>
                    <li>Kedvez≈ë √°r</li>
                </ul>
                <form action="/create-checkout-session-web" method="POST">
                    <input type="hidden" name="plan" value="weekly">
                    <button type="submit" class="button">El≈ëfizetek</button>
                </form>
            </div>
    
            <div class="pricing-card popular">
                <div style="background: #38A169; color: white; font-size: 0.8em; padding: 5px; border-radius: 5px; margin-bottom: 10px; display: inline-block;">LEGJOBB AJ√ÅNLAT</div>
                <h3>üìÖ Havi Csomag</h3>
                <p class="price">9.999 Ft<span>/h√≥</span></p>
                <ul class="features">
                    <li>30 napos hozz√°f√©r√©s</li>
                    <li>Legjobb √°r/√©rt√©k ar√°ny</li>
                    <li>Folyamatos profit lehet≈ës√©g</li>
                </ul>
                <form action="/create-checkout-session-web" method="POST">
                    <input type="hidden" name="plan" value="monthly">
                    <button type="submit" class="button" style="background-color: #38A169;">K√©rem a Profitot</button>
                </form>
            </div>
        </div>
    {% endif %}

<script>
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('payment') && urlParams.get('payment') === 'success') {
        const modal = document.createElement('div');
        modal.className = 'modal-success';
        modal.innerHTML = '<h2>Sikeres Fizet√©s!</h2><p>K√∂sz√∂nj√ºk az el≈ëfizet√©sed! A VIP tippek mostant√≥l el√©rhet≈ëek sz√°modra.</p><button onclick="this.parentElement.remove()">Bez√°r√°s</button>';
        document.body.appendChild(modal);
    }
    if (urlParams.has('error') && urlParams.get('error') === 'active_subscription') {
        const modal = document.createElement('div');
        modal.className = 'modal-error';
        modal.innerHTML = '<h2>M√°r van el≈ëfizet√©sed!</h2><p>A rendszer√ºnk szerint m√°r rendelkezel akt√≠v el≈ëfizet√©ssel. √öjabb v√°s√°rl√°sra nincs sz√ºks√©g.</p><button onclick="this.parentElement.remove()">Bez√°r√°s</button>';
        document.body.appendChild(modal);
    }
</script>

{% endblock %}
