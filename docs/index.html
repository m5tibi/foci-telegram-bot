<!DOCTYPE html>
<html>
<head>
    <title>Mondom a Tutit - Előfizetés</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <div class="container" id="main-container">
        <h1>Mondom a Tutit! ⚽️</h1>
        <h2>Prémium Előfizetés</h2>
        <p>Szerezz hozzáférést a napi tippekhez és a Napi Tuti szelvényekhez!</p>
        
        <div class="package">
            <h3>Havi Hozzáférés</h3>
            <p class="price">9999 Ft / hónap</p>
            <p>Teljeskörű hozzáférés a bothoz 30 napig.</p>
            <button id="checkout-button">Előfizetek</button>
        </div>
        
        <div id="error-message"></div>
    </div>

    <div class="container" id="success-container" style="display: none;">
        <h1>✅ Sikeres Fizetés!</h1>
        <p>Köszönjük az előfizetést! A Telegram botban már aktív a hozzáférésed.</p>
        <p>A /start paranccsal bármikor előhozhatod a menüt.</p>
    </div>

    <script type="text/javascript">
      // FONTOS: Cseréld le a 'pk_test_...' részt a saját Stripe publikálható kulcsodra!
      var stripe = Stripe('pk_test_51RxsXRGwJ52Lmi82tbAPlmPQBIGfB2FZKrRl37lrawkkLiJO00J3AGeYagNtBYFjy0fxrACUiZnypHx6xnayDmKa00MU2L1GHr');
      var checkoutButton = document.getElementById('checkout-button');
      var errorElement = document.getElementById('error-message');
      
      const urlParams = new URLSearchParams(window.location.search);
      const paymentStatus = urlParams.get('payment');
      const chatId = urlParams.get('chat_id');

      if (paymentStatus === 'success') {
          document.getElementById('main-container').style.display = 'none';
          document.getElementById('success-container').style.display = 'block';
      }

      checkoutButton.addEventListener('click', function() {
        if (!chatId) {
            errorElement.textContent = "Hiba: Felhasználói azonosító hiányzik. Kérlek, a botból indítsd újra a folyamatot!";
            return;
        }

        checkoutButton.disabled = true;
        checkoutButton.textContent = "Átirányítás a fizetéshez...";
        
        var renderApiUrl = 'https://foci-telegram-bot.onrender.com/create-checkout-session';

        fetch(renderApiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chat_id: chatId })
        })
        .then(response => response.json())
        .then(session => {
            if (session.id) {
                return stripe.redirectToCheckout({ sessionId: session.id });
            } else {
                throw new Error(session.error || 'Hiba a fizetési munkamenet létrehozásakor.');
            }
        })
        .catch(function(error) {
            console.error('Hiba:', error);
            errorElement.textContent = 'Hiba történt a fizetési oldal betöltésekor. Kérlek, próbáld újra később.';
            checkoutButton.disabled = false;
            checkoutButton.textContent = "Előfizetek";
        });
      });
    </script>
</body>
</html>
