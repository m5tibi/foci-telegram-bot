<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingyenes Foci Tippek - DIAGNOSZTIKA</title>
    <link rel="icon" type="image/png" href="images/favicon.png">
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f7f6; }
        .container { max-width: 800px; margin: 0 auto; }
        .slip-card { background: white; padding: 10px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: block; text-decoration: none; color: inherit; }
        .slip-card img { width: 100%; height: auto; display: block; }
        #debug-log { background: #000; color: #0f0; padding: 15px; border-radius: 5px; font-family: monospace; margin-bottom: 20px; white-space: pre-wrap; word-break: break-all; }
        .btn { display: inline-block; background: #38A169; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üîç Hibakeres≈ë M√≥d</h1>
        <p>Ez az oldal megmutatja, hol akad el a bet√∂lt√©s mobilon.</p>
        
        <div id="debug-log">Napl√≥ ind√≠t√°sa...</div>

        <div id="free-slips-container"></div>
        <div id="loading-state">Bet√∂lt√©s folyamatban...</div>

        <a href="/index.html" class="btn">Vissza a F≈ëoldalra</a>
    </div>

    <script type="module">
        // Napl√≥z√≥ seg√©df√ºggv√©ny
        function log(msg) {
            const logBox = document.getElementById('debug-log');
            const time = new Date().toLocaleTimeString();
            logBox.innerHTML += `\n[${time}] ${msg}`;
            console.log(msg);
        }

        log("Script elindult.");

        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
        log("Supabase modul bet√∂ltve.");

        const SUPABASE_URL = 'https://mzfgelfidtjuqgpwxtkg.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16ZmdlbGZpZHRqdXFncHd4dGtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5MDg2OTgsImV4cCI6MjA3MDQ4NDY5OH0.qE-tviGlahOqDARyBEBgQu8T6_6DfWD2T6Oa8EWUh6M';
        
        try {
            const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
            log("Supabase kliens l√©trehozva.");
            
            async function loadFreeSlips() {
                const container = document.getElementById('free-slips-container');
                const loadingState = document.getElementById('loading-state');
                
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const today = `${year}-${month}-${day}`;
                
                log(`Mai d√°tum: ${today}`);
                log("Adatb√°zis lek√©rdez√©se ind√≠t√°sa...");

                const { data, error } = await supabase
                    .from('free_slips')
                    .select('*')
                    .gte('target_date', today)
                    .eq('status', 'Folyamatban')
                    .order('target_date', { ascending: true });

                if (error) {
                    log("‚ùå HIBA a lek√©rdez√©sben: " + JSON.stringify(error));
                    loadingState.innerHTML = 'Hiba t√∂rt√©nt az adatb√°zis el√©r√©sekor.';
                    return;
                }

                log(`Lek√©rdez√©s sikeres. Tal√°latok sz√°ma: ${data ? data.length : 0}`);

                if (data && data.length > 0) {
                    loadingState.style.display = 'none';
                    data.forEach((slip, index) => {
                        log(`#${index+1} tipp feldolgoz√°sa: ${slip.tipp_neve}`);
                        log(`K√©p URL: ${slip.image_url}`);

                        const card = document.createElement('a');
                        card.href = slip.image_url;
                        card.target = '_blank';
                        card.className = 'slip-card';

                        const img = document.createElement('img');
                        img.src = slip.image_url;
                        img.alt = slip.tipp_neve;
                        
                        // Esem√©nyfigyel≈ëk a k√©phez
                        img.onload = () => log(`‚úÖ #${index+1} K√©p sikeresen bet√∂ltve!`);
                        img.onerror = () => log(`‚ùå #${index+1} K√©p bet√∂lt√©se SIKERTELEN! (H√°l√≥zati hiba vagy rossz form√°tum)`);

                        const footer = document.createElement('div');
                        footer.style.textAlign = 'center';
                        footer.style.marginTop = '10px';
                        footer.innerHTML = `<strong>${slip.tipp_neve}</strong><br><small>${slip.target_date}</small>`;

                        card.appendChild(img);
                        card.appendChild(footer);
                        container.appendChild(card);
                    });
                } else {
                    log("Nincs megjelen√≠thet≈ë tipp (√ºres lista).");
                    loadingState.innerHTML = 'Jelenleg nincsenek akt√≠v ingyenes tippek.';
                }
            }
            
            // Ind√≠t√°s
            loadFreeSlips();

        } catch (e) {
            log("üî• KRITIKUS HIBA: " + e.message);
        }
    </script>
</body>
</html>
