<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingyenes Foci Tippek - KOMPATIBILIS M√ìD</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f7f6; }
        .container { max-width: 800px; margin: 0 auto; }
        .slip-card { background: white; padding: 10px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: block; text-decoration: none; color: inherit; }
        .slip-card img { width: 100%; height: auto; display: block; }
        #debug-log { background: #000; color: #0f0; padding: 15px; border-radius: 5px; font-family: monospace; margin-bottom: 20px; white-space: pre-wrap; word-break: break-all; }
        .btn { display: inline-block; background: #38A169; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin-top: 20px; }
    </style>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <div class="container">
        <h1>üîß Kompatibilis Hibakeres≈ë</h1>
        <div id="debug-log">Napl√≥ ind√≠t√°sa...</div>
        <div id="free-slips-container"></div>
        <div id="loading-state">Bet√∂lt√©s...</div>
        <a href="/index.html" class="btn">Vissza a F≈ëoldalra</a>
    </div>

    <script>
        // Napl√≥z√≥ seg√©df√ºggv√©ny
        function log(msg) {
            const logBox = document.getElementById('debug-log');
            const time = new Date().toLocaleTimeString();
            logBox.innerHTML += `\n[${time}] ${msg}`;
        }

        // Hib√°k elkap√°sa (ha a script √∂sszeomlana)
        window.onerror = function(message, source, lineno, colno, error) {
            log(`üî• KRITIKUS B√ñNG√âSZ≈ê HIBA: ${message} (Sor: ${lineno})`);
        };

        log("1. Script elindult (Hagyom√°nyos m√≥dban).");

        const SUPABASE_URL = 'https://mzfgelfidtjuqgpwxtkg.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16ZmdlbGZpZHRqdXFncHd4dGtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5MDg2OTgsImV4cCI6MjA3MDQ4NDY5OH0.qE-tviGlahOqDARyBEBgQu8T6_6DfWD2T6Oa8EWUh6M';

        try {
            // Ellen≈ërizz√ºk, hogy a Supabase bet√∂lt≈ëd√∂tt-e
            if (typeof supabase === 'undefined') {
                throw new Error("A Supabase k√∂nyvt√°r nem t√∂lt≈ëd√∂tt be! (CDN Hiba)");
            }
            log("2. Supabase k√∂nyvt√°r √©szlelve.");

            const { createClient } = supabase;
            const sbClient = createClient(SUPABASE_URL, SUPABASE_KEY);
            log("3. Kliens l√©trehozva.");

            async function loadFreeSlips() {
                const container = document.getElementById('free-slips-container');
                const loadingState = document.getElementById('loading-state');
                
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const today = `${year}-${month}-${day}`;
                
                log(`4. Mai d√°tum: ${today}`);
                log("5. Adatb√°zis lek√©rdez√©se...");

                const { data, error } = await sbClient
                    .from('free_slips')
                    .select('*')
                    .gte('target_date', today)
                    .eq('status', 'Folyamatban')
                    .order('target_date', { ascending: true });

                if (error) {
                    log("‚ùå HIBA a lek√©rdez√©sben: " + JSON.stringify(error));
                    loadingState.innerHTML = 'Adatb√°zis hiba.';
                    return;
                }

                log(`6. Lek√©rdez√©s k√©sz. Eredm√©ny: ${data ? data.length : 0} db tipp.`);

                if (data && data.length > 0) {
                    loadingState.style.display = 'none';
                    data.forEach((slip, index) => {
                        log(`#${index+1} K√©p URL: ${slip.image_url}`);

                        const card = document.createElement('a');
                        card.href = slip.image_url;
                        card.target = '_blank';
                        card.className = 'slip-card';

                        const img = document.createElement('img');
                        img.src = slip.image_url;
                        img.alt = slip.tipp_neve;
                        
                        img.onload = () => log(`‚úÖ #${index+1} K√©p bet√∂ltve!`);
                        img.onerror = () => log(`‚ùå #${index+1} K√©p bet√∂lt√©se SIKERTELEN!`);

                        const footer = document.createElement('div');
                        footer.style.textAlign = 'center';
                        footer.innerHTML = `<strong>${slip.tipp_neve}</strong><br><small>${slip.target_date}</small>`;

                        card.appendChild(img);
                        card.appendChild(footer);
                        container.appendChild(card);
                    });
                } else {
                    log("‚ö†Ô∏è √úres a lista (Nincs tal√°lat).");
                    loadingState.innerHTML = 'Nincs akt√≠v tipp.';
                }
            }

            loadFreeSlips();

        } catch (e) {
            log("üî• SCRIPT HIBA: " + e.message);
        }
    </script>
</body>
</html>
